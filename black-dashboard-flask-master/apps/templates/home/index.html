{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <div class="content" style="padding-left: 30px">

        <div class="row">
            <div class="col ">
                <div class="card card-chart">
                    <div class="card-header ">
                        <div class="row">
                            <div class="col text-left">
                                <h5 class="card-category">Cases</h5>
                                <h2 class="card-title">Normal  </h2>
                                <h2 class="card-title" style="text-align: right;color: #48d078;font-weight: bold" id="title11">   </h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col ">
                <div class="card card-chart">
                    <div class="card-header ">
                        <div class="row">
                            <div class="col  text-left">
                                <h5 class="card-category">Cases</h5>
                                <h2 class="card-title" >Abnormal   </h2>
                                <h2 class="card-title" style="text-align: right;color: #4873d0;font-weight: bold" id="title12">   </h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col ">
                <div class="card card-chart">
                    <div class="card-header ">
                        <div class="row">
                            <div class="col text-left">
                                <h5 class="card-category">Cases</h5>
                                <h2 class="card-title" >Inconclusive   </h2>
                                    <h2 class="card-title" style="text-align: right;color: #d04891;font-weight: bold" id="title13">   </h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> 
        <div class="row">
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h5 class="card-category">Patients by Age Groups</h5>
                        <h3 class="card-title"> &nbsp; </h3>
                    </div>
                    <div class="card-body hidden" >
                        <div class="chart-area" style="height: 400px">
                            <canvas id="chartLinePurple"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h2 class="card-category">Patients By Gender</h2>
                        <h3 class="card-title"><i class="tim-icons icon-single-02 text-info"></i> {{ totalPatients }}
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="height: 400px">
                            <canvas id="CountryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row ">
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h2 class="card-category">Patients By Gender</h2>
                        <h3 class="card-title"><i class="tim-icons icon-single-02 text-info"></i> {{ totalPatients }}
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="height: 400px">
                            <canvas id="CountryChart22"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h5 class="card-category">Completed Tasks</h5>
                        <h3 class="card-title"><i class="tim-icons icon-send text-success"></i> {{ sumTotalBills }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="height: 400px">
                            <canvas id="chartLineGreen"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row ">
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h2 class="card-category">Patients By Gender</h2>
                        <h3 class="card-title"><i class="tim-icons icon-single-02 text-info"></i> {{ totalPatients }}
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="height: 400px">
                            <canvas id="chartLineBlue"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            {#            <div class="col">#}
            {#                <div class="card card-chart">#}
            {#                    <div class="card-header">#}
            {#                        <h5 class="card-category">Completed Tasks</h5>#}
            {#                        <h3 class="card-title"><i class="tim-icons icon-send text-success"></i> 12,100K</h3>#}
            {#                    </div>#}
            {#                    <div class="card-body">#}
            {#                        <div class="chart-area"  style="height: 400px">#}
            {#                            <canvas id="chartLineGreen"></canvas>#}
            {#                        </div>#}
            {#                    </div>#}
            {#                </div>#}
            {#            </div>#}
        </div>
        <div class="row ">
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h2 class="card-category">Patients By Gender</h2>
                        <h3 class="card-title"><i class="tim-icons icon-single-02 text-info"></i> {{ totalPatients }}
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="height: 400px">
                            <canvas id="multiBar"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row ">
            <div class="col">
                <div class="card card-chart">
                    <div class="card-header">
                        <h2 class="card-category">Patients By Gender</h2>
                        <h3 class="card-title"><i class="tim-icons icon-single-02 text-info"></i> {{ totalPatients }}
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="height: 400px">
                            <canvas id="multiBar2"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

    <script>
        function updateState() {

            fetch('/state')
                {#.then(response => response.json())#}
                {#.then(response => response.json())#}
                .then(response => {
                     return response.json()
                })
                .then(data => {
                  document.getElementById('title11').innerText =    data[2]
                  document.getElementById('title12').innerText =    data[0]
                  document.getElementById('title13').innerText =    data[1]
                });
        }

        setInterval(updateState, 3000); // Update every 3 seconds
        updateState(); // Initial update
        $(document).ready(function () {
            var data = {{ chart_json | safe }}
                gradientChartOptionsConfigurationWithTooltipBlue = {
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },

                    tooltips: {
                        backgroundColor: '#f5f5f5',
                        titleFontColor: '#333',
                        bodyFontColor: '#666',
                        bodySpacing: 4,
                        xPadding: 12,
                        mode: "nearest",
                        intersect: 0,
                        position: "nearest"
                    },
                    responsive: true,
                    scales: {
                        yAxes: [{
                            barPercentage: 1.6,
                            gridLines: {
                                drawBorder: false,
                                color: 'rgba(29,140,248,0.0)',
                                zeroLineColor: "transparent",
                            },
                            ticks: {
                                suggestedMin: 60,
                                suggestedMax: 125,
                                padding: 20,
                                fontColor: "#2380f7"
                            }
                        }],

                        xAxes: [{
                            barPercentage: 1.6,
                            gridLines: {
                                drawBorder: false,
                                color: 'rgba(29,140,248,0.1)',
                                zeroLineColor: "transparent",
                            },
                            ticks: {
                                padding: 20,
                                fontColor: "#2380f7"
                            }
                        }]
                    }
                };

            gradientChartOptionsConfigurationWithTooltipPurple = {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },

                tooltips: {
                    backgroundColor: '#f5f5f5',
                    titleFontColor: '#333',
                    bodyFontColor: '#666',
                    bodySpacing: 4,
                    xPadding: 12,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest"
                },
                responsive: true,
                scales: {
                    yAxes: [{
                        barPercentage: 1.6,
                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(29,140,248,0.0)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            suggestedMin: 60,
                            suggestedMax: 125,
                            padding: 20,
                            fontColor: "#9a9a9a"
                        }
                    }],

                    xAxes: [{
                        barPercentage: 1.6,
                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(225,78,202,0.1)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            padding: 20,
                            fontColor: "#9a9a9a"
                        }
                    }]
                }
            };

            gradientChartOptionsConfigurationWithTooltipOrange = {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },

                tooltips: {
                    backgroundColor: '#f5f5f5',
                    titleFontColor: '#333',
                    bodyFontColor: '#666',
                    bodySpacing: 4,
                    xPadding: 12,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest"
                },
                responsive: true,
                scales: {
                    yAxes: [{
                        barPercentage: 1.6,
                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(29,140,248,0.0)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            suggestedMin: 50,
                            suggestedMax: 110,
                            padding: 20,
                            fontColor: "#ff8a76"
                        }
                    }],

                    xAxes: [{
                        barPercentage: 1.6,
                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(220,53,69,0.1)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            padding: 20,
                            fontColor: "#ff8a76"
                        }
                    }]
                }
            };

            gradientChartOptionsConfigurationWithTooltipGreen = {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },

                tooltips: {
                    backgroundColor: '#f5f5f5',
                    titleFontColor: '#333',
                    bodyFontColor: '#666',
                    bodySpacing: 4,
                    xPadding: 12,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest"
                },
                responsive: true,
                scales: {
                    yAxes: [{
                        barPercentage: 1.6,
                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(29,140,248,0.0)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            suggestedMin: 50,
                            suggestedMax: 125,
                            padding: 20,
                            fontColor: "#9e9e9e"
                        }
                    }],

                    xAxes: [{
                        barPercentage: 1.6,
                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(0,242,195,0.1)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            padding: 20,
                            fontColor: "#9e9e9e"
                        }
                    }]
                }
            };


            gradientBarChartConfiguration = {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },

                tooltips: {
                    backgroundColor: '#f5f5f5',
                    titleFontColor: '#333',
                    bodyFontColor: '#666',
                    bodySpacing: 4,
                    xPadding: 12,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest"
                },
                responsive: true,
                scales: {
                    yAxes: [{

                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(29,140,248,0.1)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            suggestedMin: 120,
                            suggestedMax: 200,
                            padding: 50,
                            fontColor: "#9e9e9e"
                        }
                    }],

                    xAxes: [{

                        gridLines: {
                            drawBorder: false,
                            color: 'rgba(29,140,248,0.1)',
                            zeroLineColor: "transparent",
                        },
                        ticks: {
                            padding: 20,
                            fontColor: "#9e9e9e"
                        }
                    }]
                }
            };

            var ctx = document.getElementById("chartLinePurple").getContext("2d");

            var gradientStroke = ctx.createLinearGradient(0, 230, 0, 50);

            gradientStroke.addColorStop(1, 'rgba(72,72,176,0.2)');
            gradientStroke.addColorStop(0.2, 'rgba(72,72,176,0.0)');
            gradientStroke.addColorStop(0, 'rgba(119,52,169,0)'); //purple colors

            var data = {
                labels: ['15-29', '30-44', '45-59', '60-74', '75+'],
                datasets: [{
                    label: "Data",
                    fill: true,
                    backgroundColor: gradientStroke,
                    borderColor: '#d048b6',
                    borderWidth: 2,
                    borderDash: [],
                    borderDashOffset: 0.0,
                    pointBackgroundColor: '#d048b6',
                    pointBorderColor: 'rgba(255,255,255,0)',
                    pointHoverBackgroundColor: '#d048b6',
                    pointBorderWidth: 20,
                    pointHoverRadius: 4,
                    pointHoverBorderWidth: 15,
                    pointRadius: 4,
                    data: {{ countsAge }},
                }]
            };

            var myChart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: gradientChartOptionsConfigurationWithTooltipPurple
            });


            var ctxGreen = document.getElementById("chartLineGreen").getContext("2d");

            var gradientStroke = ctx.createLinearGradient(0, 230, 0, 50);

            gradientStroke.addColorStop(1, 'rgba(66,134,121,0.15)');
            gradientStroke.addColorStop(0.4, 'rgba(66,134,121,0.0)'); //green colors
            gradientStroke.addColorStop(0, 'rgba(66,134,121,0)'); //green colors


            var myChart = new Chart(ctxGreen, {
                type: 'bar',
                responsive: true,
                legend: {
                    display: false
                },
                data: {
                    labels: {{ providers|tojson }},
                    datasets: [{
                        label: "Patients",
                        fill: true,
                        backgroundColor: gradientStroke,
                        hoverBackgroundColor: gradientStroke,
                        borderColor: '#00d6b4',
                        borderWidth: 2,
                        borderDash: [],
                        borderDashOffset: 0.0,
                        data: {{ countsProviders }},
                    }]
                },
                options: gradientBarChartConfiguration

            });
            var ctxBlue = document.getElementById("chartLineBlue").getContext("2d");

            var gradientStroke = ctx.createLinearGradient(0, 230, 0, 50);

            gradientStroke.addColorStop(1, 'rgba(214,0,0,0.22)');
            gradientStroke.addColorStop(0.4, 'rgba(66,134,121,0.0)'); //green colors
            gradientStroke.addColorStop(0, 'rgba(66,134,121,0)'); //green colors


            var myChartBlue = new Chart(ctxBlue, {
                type: 'bar',
                responsive: true,
                legend: {
                    display: false
                },
                data: {
                    labels: {{ bloodTypes|tojson }},
                    datasets: [{
                        label: "Patients",
                        fill: true,
                        backgroundColor: gradientStroke,
                        hoverBackgroundColor: gradientStroke,
                        borderColor: 'rgba(214,0,0,0.8)',
                        borderWidth: 2,
                        borderDash: [],
                        borderDashOffset: 0.0,
                        data: {{ bloodTypesCounts }},
                    }]
                },
                options: gradientBarChartConfiguration

            });

            {#var chart_labels = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];#}
            {#var chart_data = [100, 70, 90, 70, 85, 60, 75, 60, 90, 80, 110, 100];#}
            {##}
            {##}
            {#var ctx = document.getElementById("chartBig1").getContext('2d');#}
            {##}
            {#var gradientStroke = ctx.createLinearGradient(0, 230, 0, 50);#}
            {##}
            {#gradientStroke.addColorStop(1, 'rgba(72,72,176,0.1)');#}
            {#gradientStroke.addColorStop(0.4, 'rgba(72,72,176,0.0)');#}
            {#gradientStroke.addColorStop(0, 'rgba(119,52,169,0)'); //purple colors#}
            {#var config = {#}
            {#    type: 'line',#}
            {#    data: {#}
            {#        labels: chart_labels,#}
            {#        datasets: [{#}
            {#            label: "My First dataset",#}
            {#            fill: true,#}
            {#            backgroundColor: gradientStroke,#}
            {#            borderColor: '#d346b1',#}
            {#            borderWidth: 2,#}
            {#            borderDash: [],#}
            {#            borderDashOffset: 0.0,#}
            {#            pointBackgroundColor: '#d346b1',#}
            {#            pointBorderColor: 'rgba(255,255,255,0)',#}
            {#            pointHoverBackgroundColor: '#d346b1',#}
            {#            pointBorderWidth: 20,#}
            {#            pointHoverRadius: 4,#}
            {#            pointHoverBorderWidth: 15,#}
            {#            pointRadius: 4,#}
            {#            data: chart_data,#}
            {#        }]#}
            {#    },#}
            {#    options: gradientChartOptionsConfigurationWithTooltipPurple#}
            {#};#}
            {#var myChartData = new Chart(ctx, config);#}
            {#$("#0").click(function () {#}
            {#    var data = myChartData.config.data;#}
            {#    data.datasets[0].data = chart_data;#}
            {#    data.labels = chart_labels;#}
            {#    myChartData.update();#}
            {#});#}
            {#$("#1").click(function () {#}
            {#    var chart_data = data;#}
            {#    var data = myChartData.config.data;#}
            {#    data.datasets[0].data = chart_data;#}
            {#    data.labels = chart_labels;#}
            {#    myChartData.update();#}
            {#});#}
            {##}
            {#$("#2").click(function () {#}
            {#    var chart_data = data;#}
            {#    var data = myChartData.config.data;#}
            {#    data.datasets[0].data = chart_data;#}
            {#    data.labels = chart_labels;#}
            {#    myChartData.update();#}
            {#});#}


            var ctx = document.getElementById("CountryChart").getContext("2d");

            var gradientStroke = ctx.createLinearGradient(0, 230, 0, 50);

            gradientStroke.addColorStop(1, 'rgba(29,140,248,0.2)');
            gradientStroke.addColorStop(0.4, 'rgba(29,140,248,0.0)');
            gradientStroke.addColorStop(0, 'rgba(29,140,248,0)'); //blue colors


            var myChart = new Chart(ctx, {
                type: 'bar',
                responsive: true,
                legend: {
                    display: false
                },
                data: {
                    labels: ['Female', 'Male'],
                    datasets: [{
                        label: "Patients",
                        fill: true,
                        backgroundColor: gradientStroke,
                        hoverBackgroundColor: gradientStroke,
                        borderColor: '#1f8ef1',
                        borderWidth: 2,
                        borderDash: [],
                        borderDashOffset: 0.0,
                        data: {{ counts }},
                    }]
                },
                options: gradientBarChartConfiguration
            });


            var multiBar = document.getElementById("multiBar").getContext("2d");

            var multiBarStroke = multiBar.createLinearGradient(0, 230, 0, 50);

            multiBarStroke.addColorStop(1, 'rgba(241,31,237,0.26)');
            multiBarStroke.addColorStop(0.4, 'rgba(29,140,248,0.0)');
            multiBarStroke.addColorStop(0, 'rgba(29,140,248,0)'); //blue colors


            var multiBarchart = new Chart(multiBar, {
                type: 'bar',
                responsive: true,
                legend: {
                    display: false
                },
                data: {
                    labels: {{ conditions|tojson }},
                    datasets: [
                        {
                            label: 'Female',
                            data: {{ dataset['Female'] |tojson }},
                            backgroundColor: multiBarStroke,
                            hoverBackgroundColor: multiBarStroke,
                            borderColor: '#f11fed',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                        {
                            label: 'Male',
                            data: {{ dataset['Male'] |tojson }},
                            backgroundColor: gradientStroke,
                            hoverBackgroundColor: gradientStroke,
                            borderColor: '#1f8ef1',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                    ]
                },
                options: gradientBarChartConfiguration
            });



            var multiBar2 = document.getElementById("multiBar2").getContext("2d");

            var multiBarStroke2 = multiBar2.createLinearGradient(0, 230, 0, 50);

            multiBarStroke2.addColorStop(1, 'rgba(241,31,237,0.26)');
            multiBarStroke2.addColorStop(0.4, 'rgba(29,140,248,0.0)');
            multiBarStroke2.addColorStop(0, 'rgba(29,140,248,0)'); //blue colors


            var multiBarchart2 = new Chart(multiBar2, {
                type: 'bar',
                responsive: true,
                legend: {
                    display: false
                },
                data: {
                    labels: {{ conditions|tojson }},
                    datasets: [
                        {
                            label: '15-29',
                            data: {{ data_for_plot['15-29'] |tojson }},
                            backgroundColor: gradientStroke,
                            hoverBackgroundColor: gradientStroke,
                            borderColor: '#1ff188',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                        {
                            label: '30-44',
                            data: {{ data_for_plot['30-44'] |tojson }},
                            backgroundColor: gradientStroke,
                            hoverBackgroundColor: gradientStroke,
                            borderColor: '#1feaf1',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                        {
                            label: '45-59',
                            data: {{ data_for_plot['45-59'] |tojson }},
                            backgroundColor: gradientStroke,
                            hoverBackgroundColor: gradientStroke,
                            borderColor: '#1f8ef1',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                        {
                            label:  '60-74',
                            data: {{ data_for_plot['60-74'] |tojson }},
                            backgroundColor: gradientStroke,
                            hoverBackgroundColor: gradientStroke,
                            borderColor: '#541ff1',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                        {
                            label:  '75+',
                            data: {{ data_for_plot['75+'] |tojson }},
                            backgroundColor: gradientStroke,
                            hoverBackgroundColor: gradientStroke,
                            borderColor: '#cb1ff1',
                            borderWidth: 2,
                            borderDash: [],
                            borderDashOffset: 0.0,
                        },
                    ]
                },
                options: gradientBarChartConfiguration
            });


            var ctx2 = document.getElementById("CountryChart22").getContext("2d");

            var gradientStroke2 = ctx2.createLinearGradient(0, 230, 0, 50);

            gradientStroke2.addColorStop(1, 'rgba(29,140,248,0.2)');
            gradientStroke2.addColorStop(0.4, 'rgba(29,140,248,0.0)');
            gradientStroke2.addColorStop(0, 'rgba(29,140,248,0)'); //blue colors


            var myChart2 = new Chart(ctx2, {
                type: 'pie',
                responsive: true,
                legend: {
                    display: false
                },
                data: {
                    labels: {{ labelsCondition |tojson }},
                    datasets: [{
                        label: "Patient",
                        fill: true,
                        backgroundColor: gradientStroke2,
                        hoverBackgroundColor: gradientStroke2,
                        borderColor: '#1f8ef1',
                        borderWidth: 2,
                        borderDash: [],
                        borderDashOffset: 0.0,
                        data: {{ countsCondition }},
                    }]
                },
                options: gradientBarChartConfiguration
            });

        });


    </script>

{% endblock javascripts %}
